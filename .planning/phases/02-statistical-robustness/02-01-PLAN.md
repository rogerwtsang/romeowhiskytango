---
phase: 02-statistical-robustness
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - .planning/phases/02-statistical-robustness/02-FINDINGS-DRAFT.md
autonomous: true

must_haves:
  truths:
    - "Probability decomposition math (BA/OBP/SLG → PA outcomes) is documented with theoretical soundness assessment"
    - "Hit distribution constants and thresholds have documented empirical sources or identified gaps"
    - "Bayesian smoothing approach for hit distributions is evaluated for appropriateness"
  artifacts:
    - path: ".planning/phases/02-statistical-robustness/02-FINDINGS-DRAFT.md"
      provides: "Statistical audit findings for probability and hit distribution components"
      min_lines: 100
      contains: "## Probability Decomposition"
  key_links:
    - from: "config.py HIT_DISTRIBUTIONS constants"
      to: "findings document"
      via: "empirical source documentation"
      pattern: "HIT_DISTRIBUTIONS.*source|derive"
    - from: "probability.py decompose_slash_line"
      to: "findings document"
      via: "mathematical correctness assessment"
      pattern: "decompose_slash_line.*soundness"
---

<objective>
Audit the probability decomposition and hit distribution components of the simulation model for statistical soundness and documentation quality.

Purpose: Identify weak assumptions and missing documentation in core probability calculations to inform future refinement work.

Output: Draft findings document covering probability math and hit distributions with recommendations for improvement.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-statistical-robustness/02-CONTEXT.md
@.planning/ANALYSIS_NOTES.md

# Codebase understanding
@.planning/codebase/ARCHITECTURE.md
@.planning/codebase/CONVENTIONS.md

# Files to audit
@src/models/probability.py
@config.py
</context>

<tasks>

<task type="auto">
  <name>Audit probability decomposition math</name>
  <files>.planning/phases/02-statistical-robustness/02-FINDINGS-DRAFT.md</files>
  <action>
Create draft findings document at `.planning/phases/02-statistical-robustness/02-FINDINGS-DRAFT.md`.

**Section 1: Probability Decomposition (decompose_slash_line)**

Examine `src/models/probability.py::decompose_slash_line()` function (lines 105-170):

1. **Mathematical correctness:**
   - Verify that `p_walk = obp - ba` is theoretically sound
   - Verify that `p_hit = ba` is correct
   - Verify that `p_total_outs = 1.0 - obp` follows from definitions
   - Check if strikeout splitting (lines 141-154) handles edge cases correctly
   - Identify any mathematical assumptions or approximations

2. **K% clamping behavior (ANALYSIS_NOTES.md Issue #2):**
   - Document the silent clamping at lines 145-147, 152-154
   - Assess whether this is statistically appropriate or a band-aid fix
   - Recommend logging/warning approach if this indicates data quality issues

3. **Documentation gaps:**
   - Are the formulas explained in docstrings?
   - Are edge cases documented?
   - Are assumptions stated clearly?

**Format:**
```markdown
## Probability Decomposition

### Mathematical Soundness

[Assessment of formulas with specific line references]

### Edge Case Handling

[K% clamping analysis, including lines 145-147, 152-154]

### Documentation Quality

[What's documented well, what's missing]

### Recommendations

[Specific improvements needed]
```
  </action>
  <verify>
    cat .planning/phases/02-statistical-robustness/02-FINDINGS-DRAFT.md | grep -A 20 "## Probability Decomposition"
  </verify>
  <done>Draft findings document exists with comprehensive analysis of probability decomposition including math correctness, K% clamping, and documentation gaps</done>
</task>

<task type="auto">
  <name>Audit hit distribution modeling</name>
  <files>.planning/phases/02-statistical-robustness/02-FINDINGS-DRAFT.md</files>
  <action>
Append to the draft findings document.

**Section 2: Hit Type Distributions**

Examine `config.py` (lines 38-74) and `src/models/probability.py::calculate_hit_distribution()` (lines 11-102):

1. **HIT_DISTRIBUTIONS constants (ANALYSIS_NOTES.md Issue #3):**
   - Document current values in config.py lines 46-65
   - Assess whether values appear reasonable (compare to typical MLB distributions if known)
   - Identify missing empirical source/citation
   - Note ANALYSIS_NOTES.md recommendation: "Document empirical source or derive from historical MLB data"

2. **ISO thresholds (ANALYSIS_NOTES.md Issue #7):**
   - Document thresholds at config.py lines 39-43 (0.100, 0.200)
   - Assess if these align with common baseball analytics definitions (e.g., Fangraphs' ISO categories)
   - Identify missing source citation

3. **Bayesian smoothing approach:**
   - Examine lines 56-69 in probability.py
   - Assess `prior_weight = 100` (line 58) - is this appropriate?
   - Verify that smoothing formula is mathematically correct: `(prior * weight1 + actual * weight2) / (weight1 + weight2)`
   - Compare to ANALYSIS_NOTES.md recommendation for stolen bases (beta-binomial) - is hit distribution using appropriate conjugate prior?

4. **League average fallback:**
   - Assess LEAGUE_AVG_HIT_DISTRIBUTION (config.py lines 68-73)
   - Is this documented source? Does it need empirical validation?

**Format:**
```markdown
## Hit Type Distributions

### Constants and Thresholds

[Analysis of HIT_DISTRIBUTIONS and ISO_THRESHOLDS with source gap documentation]

### Bayesian Smoothing

[Assessment of prior_weight=100, formula correctness, appropriateness for this use case]

### League Averages

[Evaluation of fallback distribution quality and documentation]

### Recommendations

[Specific improvements needed including empirical source acquisition]
```
  </action>
  <verify>
    cat .planning/phases/02-statistical-robustness/02-FINDINGS-DRAFT.md | grep -A 30 "## Hit Type Distributions"
  </verify>
  <done>Draft findings document contains comprehensive analysis of hit distributions including constants, thresholds, Bayesian smoothing, and league averages with identified documentation gaps</done>
</task>

<task type="auto">
  <name>Document audit metadata and structure</name>
  <files>.planning/phases/02-statistical-robustness/02-FINDINGS-DRAFT.md</files>
  <action>
Add frontmatter and introduction to the draft findings document (prepend to file).

**Frontmatter:**
```yaml
---
phase: 02-statistical-robustness
document: findings
status: draft
audited: 2026-01-17
scope: probability_and_hit_distributions
next_scope: baserunning_and_special_events
---
```

**Introduction section:**
```markdown
# Statistical Model Audit - Part 1: Probability & Hit Distributions

**Audit Date:** 2026-01-17
**Scope:** Probability decomposition and hit type distribution modeling
**Methodology:** Code review against ANALYSIS_NOTES.md issues and statistical theory
**Next:** Baserunning and special events (Plan 02)

## Purpose

This audit examines the statistical assumptions underlying the Monte Carlo baseball simulator's probability calculations. The goal is to identify weak assumptions, missing documentation, and opportunities for refinement - NOT to implement fixes immediately.

## Audit Scope (This Document)

- Probability decomposition: BA/OBP/SLG → PA outcomes
- Hit type distributions: 1B/2B/3B/HR split modeling
- Bayesian smoothing for small samples
- Configuration constants and thresholds

## Assessment Criteria

For each component:
1. **Mathematical soundness:** Are formulas theoretically correct?
2. **Documentation quality:** Are assumptions and sources clearly stated?
3. **Edge case handling:** Are boundary conditions managed appropriately?
4. **Empirical grounding:** Are constants derived from real data or arbitrary?

---
```

Prepend this to the existing content.
  </action>
  <verify>
    head -30 .planning/phases/02-statistical-robustness/02-FINDINGS-DRAFT.md | grep "Statistical Model Audit"
  </verify>
  <done>Draft findings document has proper frontmatter, introduction explaining purpose and scope, and assessment criteria</done>
</task>

</tasks>

<verification>
After completing all tasks:
1. Draft findings document exists at `.planning/phases/02-statistical-robustness/02-FINDINGS-DRAFT.md`
2. Document contains comprehensive analysis of probability decomposition (K% clamping, math correctness)
3. Document contains comprehensive analysis of hit distributions (constants, thresholds, Bayesian smoothing)
4. Document has proper structure with frontmatter and introduction
5. All issues from ANALYSIS_NOTES.md Issues #2, #3, #7 are addressed in findings
</verification>

<success_criteria>
- [ ] Draft findings document created with 100+ lines of analysis
- [ ] Probability decomposition analyzed for mathematical soundness
- [ ] K% clamping behavior documented and assessed
- [ ] HIT_DISTRIBUTIONS constants evaluated with source gap identification
- [ ] ISO thresholds assessed for empirical grounding
- [ ] Bayesian smoothing approach evaluated for appropriateness
- [ ] Recommendations provided for each component
- [ ] Document structured with frontmatter, intro, and clear sections
</success_criteria>

<output>
After completion, create `.planning/phases/02-statistical-robustness/02-01-SUMMARY.md` following the standard summary template.
</output>
