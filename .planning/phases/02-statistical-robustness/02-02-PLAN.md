---
phase: 02-statistical-robustness
plan: 02
type: execute
wave: 2
depends_on: ["02-01"]
files_modified:
  - .planning/phases/02-statistical-robustness/02-FINDINGS-DRAFT.md
  - .planning/phases/02-statistical-robustness/02-FINDINGS.md
autonomous: true

must_haves:
  truths:
    - "Baserunning advancement probabilities are assessed for realism and source documentation"
    - "Special events (stolen bases, sacrifice flies, errors) are evaluated for modeling correctness"
    - "Complete findings document exists with all model components audited and recommendations provided"
  artifacts:
    - path: ".planning/phases/02-statistical-robustness/02-FINDINGS.md"
      provides: "Complete statistical audit findings covering all model components"
      min_lines: 200
      contains: "## Baserunning Model"
  key_links:
    - from: "config.py BASERUNNING_AGGRESSION constants"
      to: "findings document"
      via: "realism assessment"
      pattern: "BASERUNNING_AGGRESSION.*realism|source"
    - from: "stolen_bases.py calculate_sb_rate"
      to: "findings document"
      via: "Bayesian shrinkage gap identification"
      pattern: "stolen.*shrinkage|beta-binomial"
---

<objective>
Complete the statistical audit by analyzing baserunning and special event modeling, then finalize the comprehensive findings document.

Purpose: Finish identifying weak assumptions across the full simulation model and provide a complete analysis document to inform future refinement phases.

Output: Finalized findings document (02-FINDINGS.md) covering all model components with prioritized recommendations.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-statistical-robustness/02-CONTEXT.md
@.planning/ANALYSIS_NOTES.md

# Codebase understanding
@.planning/codebase/ARCHITECTURE.md

# Files to audit
@src/models/baserunning.py
@src/models/stolen_bases.py
@src/models/sacrifice_fly.py
@src/models/errors.py
@config.py

# Prior work (created by plan 01)
@.planning/phases/02-statistical-robustness/02-FINDINGS-DRAFT.md
</context>

<tasks>

<task type="auto">
  <name>Audit baserunning advancement model</name>
  <files>.planning/phases/02-statistical-robustness/02-FINDINGS-DRAFT.md</files>
  <action>
Append baserunning analysis to the draft findings document.

**Section 3: Baserunning Model**

Examine `config.py` (lines 29-35) and `src/models/baserunning.py::advance_runners()`:

1. **BASERUNNING_AGGRESSION constants (ANALYSIS_NOTES.md Issue #4):**
   - Document current values: single_1st_to_3rd: 0.28, double_1st_scores: 0.60, double_2nd_scores: 0.98
   - Assess realism: Do these align with MLB averages? (e.g., Statcast baserunning data if known)
   - Identify missing empirical source
   - Note ANALYSIS_NOTES.md recommendation: "Modulate by player speed proxy (e.g., SB attempt rate)"

2. **Uniform application issue:**
   - Document that same advancement probabilities apply to all players regardless of speed
   - Assess impact: How much error does this introduce? (fast vs slow runners)
   - Recommend player-specific modulation approach

3. **Deterministic vs probabilistic modes:**
   - Examine ENABLE_PROBABILISTIC_BASERUNNING toggle behavior
   - Assess whether deterministic rules (lines 34-46 in advance_runners) are too conservative or appropriate

4. **Documentation quality:**
   - Is the advancement logic clearly explained in docstrings?
   - Are the probabilistic rules documented with expected behavior?

**Format:**
```markdown
## Baserunning Model

### Advancement Probabilities

[Analysis of BASERUNNING_AGGRESSION constants with realism assessment]

### Player Speed Handling

[Gap analysis: uniform vs player-specific advancement rates]

### Deterministic vs Probabilistic Modes

[Assessment of default conservative rules and probabilistic enhancement]

### Recommendations

[Specific improvements including player speed integration]
```
  </action>
  <verify>
    grep -A 20 "## Baserunning Model" .planning/phases/02-statistical-robustness/02-FINDINGS-DRAFT.md
  </verify>
  <done>Draft findings document contains comprehensive baserunning analysis including advancement probabilities, player speed gap, and mode assessment</done>
</task>

<task type="auto">
  <name>Audit special events modeling</name>
  <files>.planning/phases/02-statistical-robustness/02-FINDINGS-DRAFT.md</files>
  <action>
Append special events analysis to the draft findings document.

**Section 4: Special Events**

Examine stolen bases, sacrifice flies, and errors modeling:

1. **Stolen Bases (ANALYSIS_NOTES.md Issues #1, #5):**

   Issue #1 - No Bayesian shrinkage on success rate (src/models/stolen_bases.py lines 28-31):
   - Document current approach: `success_rate = player.sb / total_attempts` with no smoothing
   - Identify the problem: Player with 2 SB, 0 CS gets success_rate = 1.0 (unrealistic)
   - Note ANALYSIS_NOTES.md recommendation: Beta-binomial shrinkage with prior (3 successes, 1 failure for ~75% prior)
   - Compare to hit distribution approach which DOES use Bayesian smoothing (inconsistency)

   Issue #5 - Simplified opportunity model (lines 33-42):
   - Document assumption: uniform steal opportunities across all on-base events
   - Assess realism: Steals more likely on singles/walks than doubles (runner on 1st vs 2nd)
   - Recommend more nuanced opportunity detection

2. **Sacrifice Flies (src/models/sacrifice_fly.py):**

   Issue #6 - Fixed flyout percentage (config.py line 24):
   - Document FLYOUT_PERCENTAGE = 0.35 constant
   - Assess gap: No player-specific fly ball rate (MLB players range 25-50%)
   - Recommend player-level FB% data integration if available

   Verify K% handling:
   - Check that sacrifice flies only occur on outs (not strikeouts)
   - Verify this is correctly implemented in check_sacrifice_fly()

3. **Errors and Wild Pitches (src/models/errors.py if exists):**
   - Document current implementation (if any)
   - Assess if errors are modeled or ignored
   - If ENABLE_ERRORS_WILD_PITCHES toggle exists, document its behavior

**Format:**
```markdown
## Special Events

### Stolen Bases

**Success Rate Calculation (Issue #1)**
[Analysis of missing Bayesian shrinkage with specific example]

**Opportunity Model (Issue #5)**
[Assessment of uniform vs context-specific steal opportunities]

### Sacrifice Flies

**Flyout Percentage (Issue #6)**
[Analysis of fixed 35% constant vs player-specific FB%]

**Strikeout Handling**
[Verification that sac flies only on balls in play]

### Errors and Wild Pitches

[Current state and modeling gaps]

### Recommendations

[Specific improvements for each special event type]
```
  </action>
  <verify>
    grep -A 40 "## Special Events" .planning/phases/02-statistical-robustness/02-FINDINGS-DRAFT.md
  </verify>
  <done>Draft findings document contains comprehensive special events analysis covering stolen bases (shrinkage gap, opportunity model), sacrifice flies (flyout percentage), and errors</done>
</task>

<task type="auto">
  <name>Finalize findings document</name>
  <files>.planning/phases/02-statistical-robustness/02-FINDINGS.md</files>
  <action>
Review and finalize the draft findings document.

1. **Add summary section** (append to end of document):

```markdown
---

## Summary of Findings

### Critical Issues (Affect Simulation Accuracy)

1. **No Bayesian shrinkage on stolen base success rate** (Issue #1)
   - Impact: Small-sample players get unrealistic 100% or 0% success rates
   - Priority: High
   - Recommendation: Implement beta-binomial shrinkage similar to hit distributions

2. **Silent K% clamping without warning** (Issue #2)
   - Impact: Data quality issues masked, unexpected behavior
   - Priority: Medium-High
   - Recommendation: Add logging when clamping occurs

3. **Fixed baserunning for all player speeds** (Issue #4)
   - Impact: Fast runners undervalued, slow runners overvalued
   - Priority: Medium
   - Recommendation: Modulate advancement probabilities by SB attempt rate or sprint speed

### Documentation Gaps (Affect Maintainability)

4. **HIT_DISTRIBUTIONS constants lack empirical source** (Issue #3)
   - Impact: Unknown if values are accurate, hard to validate
   - Priority: Medium
   - Recommendation: Document source or derive from historical MLB data (e.g., 2015-2024 Statcast)

5. **ISO thresholds undocumented** (Issue #7)
   - Impact: Arbitrary-seeming categorization
   - Priority: Low
   - Recommendation: Add citation (e.g., Fangraphs ISO ranges)

### Model Simplifications (Lower Priority)

6. **Fixed flyout percentage ignores player variation** (Issue #6)
   - Impact: Minor - sac fly frequency slightly off for extreme FB% players
   - Priority: Low
   - Recommendation: Integrate player FB% if available in data source

7. **Simplified steal opportunity model** (Issue #5)
   - Impact: Minor - slight overestimation of steal attempts
   - Priority: Low
   - Recommendation: Condition on base/out state more precisely

## Next Steps

These findings are **analysis only** - no fixes implemented in this phase.

**For future phases:**
- Prioritize Critical Issues (#1, #2, #4) for Phase 2b or Phase 3
- Address Documentation Gaps (#3, #7) when touching related code
- Consider Model Simplifications (#5, #6) if validation shows material impact

**Validation approach:**
- Run simulation with/without each fix to quantify impact on accuracy
- Compare to historical team results (e.g., 2024 Dodgers validation)
```

2. **Copy draft to final** and remove "DRAFT" from status:

```bash
cp .planning/phases/02-statistical-robustness/02-FINDINGS-DRAFT.md .planning/phases/02-statistical-robustness/02-FINDINGS.md
```

3. **Update frontmatter** in 02-FINDINGS.md:

Change `status: draft` to `status: final` and add `completed: 2026-01-17`.

4. **Verify document structure:**
   - Frontmatter with metadata
   - Introduction explaining purpose
   - Section 1: Probability Decomposition
   - Section 2: Hit Type Distributions
   - Section 3: Baserunning Model
   - Section 4: Special Events
   - Summary of Findings with prioritized recommendations
  </action>
  <verify>
    cat .planning/phases/02-statistical-robustness/02-FINDINGS.md | grep -E "^## " | head -10
  </verify>
  <done>Final findings document (02-FINDINGS.md) exists with complete analysis, summary section, and prioritized recommendations covering all 7 issues from ANALYSIS_NOTES.md</done>
</task>

</tasks>

<verification>
After completing all tasks:
1. Draft findings document has baserunning analysis (advancement probabilities, player speed gap)
2. Draft findings document has special events analysis (stolen bases, sacrifice flies, errors)
3. Final findings document (02-FINDINGS.md) exists with all sections and summary
4. Final document status is "final" not "draft"
5. All 7 issues from ANALYSIS_NOTES.md are covered in findings
6. Summary section prioritizes issues by impact (Critical, Documentation Gaps, Model Simplifications)
</verification>

<success_criteria>
- [ ] Baserunning model analyzed for realism and player speed gaps
- [ ] Stolen base modeling analyzed with shrinkage gap identified (Issue #1)
- [ ] Stolen base opportunity model assessed (Issue #5)
- [ ] Sacrifice fly flyout percentage analyzed (Issue #6)
- [ ] Final findings document (02-FINDINGS.md) created with 200+ lines
- [ ] Summary section categorizes 7 issues by priority
- [ ] Next steps section clarifies this is analysis-only, no implementation
- [ ] Document frontmatter updated to status: final
</success_criteria>

<output>
After completion, create `.planning/phases/02-statistical-robustness/02-02-SUMMARY.md` following the standard summary template.
</output>
