---
phase: 03-gui-foundation
plan: 04
type: execute
wave: 2
depends_on: ["03-01"]
files_modified:
  - src/gui/dashboard/results_panel.py
  - src/gui/dashboard/__init__.py
autonomous: true

must_haves:
  truths:
    - "User sees simulation results immediately after run completes"
    - "User can view summary metrics at a glance"
    - "User can expand details for charts and detailed statistics"
  artifacts:
    - path: "src/gui/dashboard/results_panel.py"
      provides: "Results display panel with summary and collapsible details"
      min_lines: 100
      exports: ["ResultsPanel"]
  key_links:
    - from: "ResultsPanel"
      to: "ResultsManager"
      via: "composition for results access"
      pattern: "self\\.results_manager"
    - from: "ResultsPanel"
      to: "CollapsibleFrame"
      via: "composition for details section"
      pattern: "CollapsibleFrame.*Details"
    - from: "ResultsPanel.display_results"
      to: "matplotlib visualization"
      via: "existing run_tab histogram code"
      pattern: "FigureCanvasTkAgg"
---

<objective>
Create ResultsPanel that displays simulation results with always-visible summary and collapsible detailed charts section.

Purpose: Provide clear results display that shows key metrics immediately while allowing deep dives into detailed statistics.

Output: ResultsPanel ready for dashboard integration, with summary display and collapsible details section.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-gui-foundation/03-CONTEXT.md
@.planning/phases/03-gui-foundation/03-RESEARCH.md
@src/gui/tabs/run_tab.py
@src/gui/widgets/summary_card.py
@src/gui/utils/results_manager.py
@src/gui/widgets/collapsible_frame.py
</context>

<tasks>

<task type="auto">
  <name>Create ResultsPanel with summary and details</name>
  <files>src/gui/dashboard/results_panel.py</files>
  <action>
Create src/gui/dashboard/results_panel.py with ResultsPanel class.

Implementation requirements:
- Inherit from ttk.Frame
- __init__ accepts parent and results_manager parameters
- Use grid geometry manager with weight configuration

Grid configuration:
- columnconfigure(0, weight=1)
- rowconfigure(0, weight=0)  # Header (fixed)
- rowconfigure(1, weight=0)  # Summary section (fixed)
- rowconfigure(2, weight=1)  # Details section (expands)

Layout:
1. Header (row 0):
   - ttk.Label with "Simulation Results" title (font bold)

2. Summary section (row 1):
   - ttk.LabelFrame with text="Summary"
   - Always visible summary metrics:
     - Mean runs per season
     - Standard deviation
     - Confidence interval (95%)
     - Number of iterations
   - Use grid layout for metrics (2 columns)

3. Details section (row 2):
   - CollapsibleFrame with text="Detailed Results & Charts"
   - Inside details content frame:
     - Matplotlib histogram (migrate from run_tab.py visualization)
     - Additional statistics (min, max, percentiles)
   - Initially collapsed to save space

Methods:
- display_results(result_data): Updates summary and details with new results
  - result_data is dict with keys: 'mean', 'std', 'ci_lower', 'ci_upper', 'iterations', 'distribution'
  - Updates summary labels with formatted values
  - Updates histogram in details section
- clear_results(): Clears all displayed data
- get_current_result(): Returns currently displayed result data

For matplotlib integration:
- Import: from matplotlib.backends.backend_tkagg import FigureCanvasTkAgg
- Migrate histogram creation from run_tab.py
- Embed FigureCanvasTkAgg in details content frame

Use ttk.Label for all text (no StringVar - RESEARCH.md Pitfall 2).
Configure all labels with direct .config(text=...) updates.

Type hints, Google-style docstrings, project conventions.
  </action>
  <verify>
    - File exists at src/gui/dashboard/results_panel.py
    - ResultsPanel class inherits from ttk.Frame
    - Contains display_results(), clear_results(), get_current_result() methods
    - Has summary section (always visible) and CollapsibleFrame for details
    - mypy src/gui/dashboard/results_panel.py shows no errors
  </verify>
  <done>
ResultsPanel created with always-visible summary metrics and collapsible details section containing histogram and additional statistics.
  </done>
</task>

<task type="auto">
  <name>Add ResultsPanel to dashboard package exports</name>
  <files>src/gui/dashboard/__init__.py</files>
  <action>
Add ResultsPanel to dashboard package exports.

Add import:
```python
from src.gui.dashboard.results_panel import ResultsPanel
```

Update __all__:
```python
__all__ = ["SetupPanel", "LineupPanel", "ResultsPanel"]
```
  </action>
  <verify>
    - ResultsPanel in src/gui/dashboard/__init__.py
    - python -c "from src.gui.dashboard import ResultsPanel; print(ResultsPanel)" runs without error
  </verify>
  <done>
ResultsPanel exported from dashboard package and importable.
  </done>
</task>

</tasks>

<verification>
Run mypy:
```bash
mypy src/gui/dashboard/results_panel.py
```

Verify import:
```bash
python -c "from src.gui.dashboard import ResultsPanel; print(ResultsPanel.__name__)"
```

Test instantiation and display:
```bash
python -c "
import tkinter as tk
from src.gui.dashboard import ResultsPanel
from src.gui.utils import ResultsManager

root = tk.Tk()
results_mgr = ResultsManager(max_results=10)
panel = ResultsPanel(root, results_manager=results_mgr)
print('ResultsPanel instantiated')

# Test display with mock data
test_data = {
    'mean': 800.5,
    'std': 15.2,
    'ci_lower': 785.0,
    'ci_upper': 816.0,
    'iterations': 1000,
    'distribution': [790, 795, 800, 805, 810]
}
panel.display_results(test_data)
print('Results displayed')

panel.clear_results()
print('Results cleared')
root.destroy()
"
```
</verification>

<success_criteria>
- ResultsPanel has summary section always visible
- ResultsPanel has CollapsibleFrame for detailed charts
- display_results() updates both summary and details
- Matplotlib histogram embedded in details section
- No StringVar usage (direct label config)
- Grid weights configured for responsive layout
- No mypy errors
- Panel instantiates and displays results without errors
</success_criteria>

<output>
After completion, create `.planning/phases/03-gui-foundation/03-04-SUMMARY.md`
</output>
