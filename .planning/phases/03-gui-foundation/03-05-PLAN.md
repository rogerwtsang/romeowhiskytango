---
phase: 03-gui-foundation
plan: 05
type: execute
wave: 3
depends_on: ["03-02", "03-03", "03-04"]
files_modified:
  - src/gui/dashboard/main_dashboard.py
  - src/gui/dashboard/__init__.py
  - gui.py
autonomous: true

must_haves:
  truths:
    - "User sees unified dashboard (not tabs)"
    - "User can resize panels with draggable dividers"
    - "User can toggle compare mode to show two lineups side-by-side"
    - "Running simulation updates results panel automatically"
  artifacts:
    - path: "src/gui/dashboard/main_dashboard.py"
      provides: "Main dashboard container with PanedWindow layout"
      min_lines: 150
      exports: ["MainDashboard"]
    - path: "gui.py"
      provides: "Updated entry point using dashboard instead of notebook"
      contains: "MainDashboard"
  key_links:
    - from: "MainDashboard"
      to: "SetupPanel/LineupPanel/ResultsPanel"
      via: "PanedWindow.add()"
      pattern: "self\\..*_paned\\.add\\("
    - from: "MainDashboard.toggle_compare_mode"
      to: "LineupPanel creation/destruction"
      via: "dynamic panel management"
      pattern: "_create_lineup_panel.*destroy\\(\\)"
    - from: "LineupPanel on_run callback"
      to: "SimulationRunner"
      via: "MainDashboard._run_simulation"
      pattern: "self\\.sim_runner\\.run_in_thread"
    - from: "SimulationRunner completion"
      to: "ResultsPanel.display_results"
      via: "callback chain"
      pattern: "self\\.results_panel\\.display_results"
---

<objective>
Create MainDashboard container that assembles all panels with resizable layout, implements compare mode toggle, and wires simulation execution to results display.

Purpose: Replace 9-tab navigation with unified dashboard, enabling simultaneous view of lineup configuration and results.

Output: Complete dashboard implementation ready to replace ttk.Notebook in gui.py entry point.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-gui-foundation/03-CONTEXT.md
@.planning/phases/03-gui-foundation/03-RESEARCH.md
@src/gui/dashboard/setup_panel.py
@src/gui/dashboard/lineup_panel.py
@src/gui/dashboard/results_panel.py
@src/gui/utils/simulation_runner.py
@src/gui/utils/results_manager.py
@gui.py
</context>

<tasks>

<task type="auto">
  <name>Create MainDashboard with PanedWindow layout and compare mode</name>
  <files>src/gui/dashboard/main_dashboard.py</files>
  <action>
Create src/gui/dashboard/main_dashboard.py with MainDashboard class.

Implementation requirements:
- Inherit from ttk.Frame
- __init__ accepts parent, config_manager, results_manager, sim_runner parameters
- Follow RESEARCH.md Pattern 1 (Resizable Dashboard with PanedWindow) and Pattern 3 (Dynamic Panel Creation)

Layout structure:
1. Main vertical PanedWindow (orient=tk.VERTICAL):
   - Top pane: SetupPanel (weight=0 - fixed initial size)
   - Bottom pane: Content horizontal PanedWindow (weight=1 - takes remaining space)

2. Content horizontal PanedWindow (orient=tk.HORIZONTAL):
   - Left: LineupPanel (weight=1)
   - Right: ResultsPanel (weight=1)

State tracking:
- self.lineup_panels = []  # Track active lineup panels (1 or 2)
- self.compare_mode = False

Methods:
- _create_layout(): Builds PanedWindow structure and initial panels
- _create_lineup_panel(): Creates LineupPanel with callbacks (on_run=self._run_simulation, on_compare=self.toggle_compare_mode)
- toggle_compare_mode():
  - If not compare_mode: Create second lineup panel, insert at position 1 in content_paned
  - If compare_mode: Remove second panel, call .forget() then .destroy(), remove from lineup_panels list
  - Toggle compare_mode flag
  - Follow RESEARCH.md Pitfall 1 pattern (proper widget destruction)
- _run_simulation(lineup_panel):
  - Get lineup data from lineup_panel.get_lineup_data()
  - Validate lineup is not empty
  - Call sim_runner.run_in_thread() with progress callback and completion callback
  - Progress callback: lineup_panel.update_progress(current, total)
  - Completion callback: self._on_simulation_complete(results, lineup_panel)
- _on_simulation_complete(results, lineup_panel):
  - Hide progress: lineup_panel.hide_progress()
  - Store results: results_manager.add_result(results)
  - Display results: results_panel.display_results(results)
- get_dashboard_state(): Returns dict with setup_collapsed, compare_mode, lineup_data for session management

Use ttk.PanedWindow.add() to add panels with weight parameter.
For compare mode, use ttk.PanedWindow.insert(position, panel, weight=1) to insert second lineup.

Proper widget lifecycle (RESEARCH.md Pitfall 1):
```python
def toggle_compare_mode(self):
    self.compare_mode = not self.compare_mode
    if self.compare_mode:
        panel = self._create_lineup_panel()
        self.content_paned.insert(1, panel, weight=1)  # Insert between first lineup and results
    else:
        if len(self.lineup_panels) > 1:
            panel = self.lineup_panels[1]
            self.content_paned.forget(panel)  # Remove from paned window
            panel.destroy()  # Free memory
            self.lineup_panels.remove(panel)  # Clear tracking
```

Type hints, Google-style docstrings, project conventions.
  </action>
  <verify>
    - File exists at src/gui/dashboard/main_dashboard.py
    - MainDashboard class inherits from ttk.Frame
    - Contains toggle_compare_mode(), _run_simulation(), get_dashboard_state() methods
    - Uses PanedWindow for resizable layout
    - Properly destroys widgets in toggle_compare_mode (calls .forget() then .destroy())
    - mypy src/gui/dashboard/main_dashboard.py shows no errors
  </verify>
  <done>
MainDashboard created with PanedWindow layout, compare mode toggle with proper widget lifecycle, and simulation execution wired to results display.
  </done>
</task>

<task type="auto">
  <name>Update gui.py to use MainDashboard</name>
  <files>gui.py</files>
  <action>
Replace ttk.Notebook-based tab structure with MainDashboard.

Changes to MonteCarloBaseballGUI class:

1. Update imports:
   - Remove: from src.gui.tabs import (all tab imports)
   - Add: from src.gui.dashboard import MainDashboard

2. In __init__, replace _create_main_ui() call with:
   ```python
   self.dashboard = MainDashboard(
       self.root,
       config_manager=self.config_manager,
       results_manager=self.results_manager,
       sim_runner=self.sim_runner
   )
   self.dashboard.pack(fill=tk.BOTH, expand=True, padx=5, pady=5)
   ```

3. Remove or comment out:
   - self._create_main_ui() method (creates notebook and tabs)
   - Tab creation code (setup_tab, lineup_tab, etc.)
   - self.notebook references

4. Keep:
   - _create_menu() method
   - _create_status_bar() method
   - _save_config() and _load_config() methods (update to use dashboard state)
   - Manager initialization (sim_runner, config_manager, results_manager)

5. Update _save_config() to call:
   ```python
   state = self.dashboard.get_dashboard_state()
   # Save state via config_manager
   ```

6. Remove _setup_callbacks() method (callbacks now handled by MainDashboard)

Keep existing menu bar, status bar, and window setup unchanged.
Only replace the main UI content (notebook → dashboard).

Preserve all existing manager instances and their initialization.
  </action>
  <verify>
    - gui.py imports MainDashboard
    - gui.py no longer imports tab classes
    - MonteCarloBaseballGUI creates MainDashboard instead of notebook
    - mypy gui.py shows no errors
    - python gui.py starts without errors (visual verification in next plan)
  </verify>
  <done>
gui.py updated to use MainDashboard, replacing 9-tab notebook structure with unified dashboard layout.
  </done>
</task>

<task type="auto">
  <name>Update dashboard package exports</name>
  <files>src/gui/dashboard/__init__.py</files>
  <action>
Add MainDashboard to dashboard package exports.

Add import:
```python
from src.gui.dashboard.main_dashboard import MainDashboard
```

Update __all__:
```python
__all__ = ["MainDashboard", "SetupPanel", "LineupPanel", "ResultsPanel"]
```

MainDashboard should be first in __all__ as it's the primary export.
  </action>
  <verify>
    - MainDashboard in src/gui/dashboard/__init__.py
    - python -c "from src.gui.dashboard import MainDashboard; print(MainDashboard)" runs without error
  </verify>
  <done>
MainDashboard exported from dashboard package as primary export.
  </done>
</task>

</tasks>

<verification>
Run mypy on all modified files:
```bash
mypy src/gui/dashboard/main_dashboard.py gui.py
```

Verify imports:
```bash
python -c "from src.gui.dashboard import MainDashboard; print(MainDashboard.__name__)"
```

Test application startup (will launch GUI):
```bash
python gui.py
```

Check that:
- Dashboard appears with Setup, Lineup, Results panels
- Panels are resizable (drag dividers)
- Setup panel has collapse/expand toggle
- Application starts without errors

Exit the application after visual confirmation.
</verification>

<success_criteria>
- MainDashboard assembles all panels with PanedWindow
- Compare mode toggle creates/destroys second lineup panel properly
- Widget destruction follows RESEARCH.md pattern (.forget() then .destroy())
- Simulation execution wired: LineupPanel → SimulationRunner → ResultsPanel
- gui.py uses MainDashboard instead of ttk.Notebook
- No mypy errors
- Application starts and displays unified dashboard
- Panels are resizable with draggable dividers
</success_criteria>

<output>
After completion, create `.planning/phases/03-gui-foundation/03-05-SUMMARY.md`
</output>
